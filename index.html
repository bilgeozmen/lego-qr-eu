<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iPhone QR Scanner</title>
<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
<style>
  body { text-align: center; font-family: Arial; }
  video { width: 90%; max-width: 400px; margin-top: 20px; }
  canvas { display: none; }
  img { margin-top: 20px; max-width: 80%; display: none; }
</style>
</head>
<body>
<h1>Scan QR Code</h1>
<video id="video" autoplay></video>
<canvas id="canvas"></canvas>
<img id="resultImage" src="" alt="Scanned QR Image">

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const img = document.getElementById("resultImage");

// QR code prefix â†’ image mapping
const qrImageMap = {
  "6576499": "https://jaysbrickblog.com/wp-content/uploads/2025/12/LEGO-71051-Minifigures-Series-28-Frog-Costume-Minifigure-2048x1635.jpg",
  "6584378": "https://jaysbrickblog.com/wp-content/uploads/2025/12/LEGO-71051-Minifigures-Series-28-Dog-Costume-Minifigure-2048x1644.jpg",
  "6576500": "https://jaysbrickblog.com/wp-content/uploads/2025/12/LEGO-71051-Minifigures-Series-28-Dog-Costume-Minifigure-2048x1644.jpg"
};

// Start the camera
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
  .then(stream => {
    video.srcObject = stream;
    video.setAttribute("playsinline", true); // iOS safari
    requestAnimationFrame(tick);
  })
  .catch(err => {
    alert("Camera access denied or not available.");
    console.error(err);
  });

// Scan loop
function tick() {
  if (video.readyState === video.HAVE_ENOUGH_DATA) {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const code = jsQR(imageData.data, imageData.width, imageData.height, { inversionAttempts: "dontInvert" });
    if (code) {
      console.log("QR Code detected:", code.data);
      const firstPart = code.data.split(" ")[0];
      const imageUrl = qrImageMap[firstPart];
      if (imageUrl) {
        img.src = imageUrl;
        img.style.display = "block";
      } else {
        img.style.display = "none";
        alert("No image found for this QR code.");
      }
      return; // stop scanning after detection
    }
  }
  requestAnimationFrame(tick);
}
</script>
</body>
</html>
