<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Code Image Viewer</title>
<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
  #resultImage { margin-top: 20px; max-width: 80%; height: auto; display: none; }
  #qr-reader { width: 300px; margin: auto; }
</style>
</head>
<body>
<h1>Scan QR Code</h1>
<div id="qr-reader"></div>
<img id="resultImage" src="" alt="Scanned QR Image">

<script>
  // Mapping QR code prefixes to image URLs
  const qrImageMap = {
    "6576499": "https://jaysbrickblog.com/wp-content/uploads/2025/12/LEGO-71051-Minifigures-Series-28-Frog-Costume-Minifigure-2048x1635.jpg",
    "6584378": "https://jaysbrickblog.com/wp-content/uploads/2025/12/LEGO-71051-Minifigures-Series-28-Dog-Costume-Minifigure-2048x1644.jpg",
    "6576500": "https://jaysbrickblog.com/wp-content/uploads/2025/12/LEGO-71051-Minifigures-Series-28-Dog-Costume-Minifigure-2048x1644.jpg"
  };

  function showImageForCode(code) {
    const firstPart = code.split(' ')[0];
    const imageUrl = qrImageMap[firstPart];
    const img = document.getElementById("resultImage");
    if (imageUrl) {
      img.src = imageUrl;
      img.style.display = "block";
    } else {
      img.style.display = "none";
      alert("No image found for this QR code.");
    }
  }

  // Wait until the page is fully loaded before starting the camera
  window.addEventListener('DOMContentLoaded', () => {
    Html5Qrcode.getCameras().then(cameras => {
      if (cameras && cameras.length) {
        const cameraId = cameras[0].id; // Use the first available camera
        const html5QrcodeScanner = new Html5Qrcode("qr-reader");

        html5QrcodeScanner.start(
          cameraId,
          { fps: 10, qrbox: 250 },
          (decodedText, decodedResult) => {
            console.log("QR Code detected:", decodedText);
            showImageForCode(decodedText);
            html5QrcodeScanner.clear(); // stop scanning after first detection
          }
        ).catch(err => {
          console.error("Camera start error:", err);
          alert("Cannot start camera. Please make sure you allowed camera access.");
        });
      } else {
        alert("No cameras found on this device.");
      }
    }).catch(err => {
      console.error("Error getting cameras:", err);
      alert("Cannot access cameras. Safari requires HTTPS and camera permission.");
    });
  });
</script>
</body>
</html>
